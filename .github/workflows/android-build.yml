name: Build Android App Bundle

on: push: branches: - main pull_request: branches: - main

jobs: build: name: Build Android App Bundle with Capacitor runs-on: ubuntu-latest

steps:
  - name: Checkout code
    uses: actions/checkout@v3

  - name: Set up Node.js
    uses: actions/setup-node@v3
    with:
      node-version: 18

  - name: Install dependencies
    run: npm install --legacy-peer-deps

  - name: Build frontend
    run: npm run build --prefix frontend

  - name: Sync Capacitor
    run: npx cap sync android

  - name: Copy web assets to Android
    run: npx cap copy android

  - name: Build Android AAB
    run: |
      cd android
      ./gradlew bundleRelease

  - name: Upload AAB artifact
    uses: actions/upload-artifact@v3
    with:
      name: app-release.aab
      path: android/app/build/outputs/bundle/release/app-release.aab
